# تقرير أمان — KUBRA / AURA

## التحقق من الحماية

- جميع API endpoints الحرجة تتطلب `X-API-KEY` (يُتحقق في Depends(get_api_key)).
- CORS production مضبوط من .env، لا يسمح بـ "*" في الإنتاج.
- رفع الملفات محدود بـ `MAX_UPLOAD_SIZE`.
- جميع الأسرار خارج الريبو (.env فقط).
- لا يوجد أي سر أو مفتاح صريح في كود الإنتاج أو الواجهة.

## M-of-N Logic/Gating

- كل العمليات الحرجة (مثل consolidation/teach) تتطلب تحقق مزدوج من trace_id و/أو المفاتيح.
- يمكن تفعيل M-of-N gating لأي endpoints حرجة عند الحاجة (مثال: توقيع رقمي/دور مشترك).

## Data Retention

- جميع البيانات (protos.jsonl, concept_graph.jsonl, memory_log.jsonl, uploads) محفوظة في data/ ويمكن حذفها يدويًا.
- لا يتم الاحتفاظ ببيانات المستخدم النهائية لأكثر من 90 يومًا بدون موافقة العميل.
- حذف تلقائي للملفات المؤقتة عبر سياسات cron/retention (توصية في التشغيل).

## معالجة PII

- لا تُخزَّن بيانات شخصية حساسة في أي مكان إلا إذا كانت ضرورية للعملية.
- كل طلب يتطلب مفتاح مصادقة، ولا توجد هوية مستخدم صريحة في logs إلا عبر trace_id.
- واجهة GUI لا تحتفظ بأي بيانات في storage أو cookies.

## تدقيق التغييرات

- جميع التغييرات تُسجّل في memory_log.jsonl (مع وقت، نوع العملية، trace_id).
- أي تغيير في النموذج/الذاكرة يسجل هوية العملية والنتيجة.

## Threat Modeling

- هجمات رفع الملفات: مقيّد بالحجم، لا يسمح بتشغيل/قراءة الملفات إلا في مسار محمي.
- هجمات API: كل endpoint حرجة تتطلب API_KEY، rate limit ممكن إضافته.
- هجمات XSS/CSRF: لا تُخزن أو تُنفذ أي بيانات من المستخدم في الواجهة مباشرة؛ كل الردود تُعالج وتعرض بأمان.

## Mitigation Summary

- كل نقطة ضعف محتملة موثقة أو تم حلها.
- يتم تحديث هذا التقرير عند كل تعديل جوهري.

---